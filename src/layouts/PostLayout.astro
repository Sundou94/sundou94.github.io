---
import BaseLayout from './BaseLayout.astro';
import { Image } from 'astro:assets';

interface Props {
  title: string;
  publishDate: Date;
  category: string;
  tags: string[];
  excerpt: string;
  coverImage?: string;
  readingMinutes?: number;
}

const {
  title,
  publishDate,
  category,
  tags,
  excerpt,
  coverImage,
  readingMinutes,
} = Astro.props;

const formattedDate = publishDate.toLocaleDateString('ko-KR', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const categoryLabels: Record<string, string> = {
  'urban-observation': '도시 관찰',
  'photography': '사진',
  'tools': '도구',
  'data': '데이터',
};
---

<BaseLayout title={title} description={excerpt} image={coverImage} type="article">
  <article class="post">
    <header class="post-header">
      <div class="container">
        <div class="post-meta">
          <span class="category">{categoryLabels[category] || category}</span>
          <time datetime={publishDate.toISOString()}>{formattedDate}</time>
          {readingMinutes && <span>{readingMinutes}분</span>}
        </div>
        <h1>{title}</h1>
        <p class="excerpt">{excerpt}</p>
      </div>
    </header>

    {
      coverImage && (
        <div class="cover-image">
          <img src={coverImage} alt={title} loading="eager" />
        </div>
      )
    }

    <div class="post-content container">
      <slot />
    </div>

    {
      tags.length > 0 && (
        <footer class="post-footer container">
          <div class="tags">
            {tags.map((tag) => (
              <a href={`/tags/${tag}`} class="tag">
                #{tag}
              </a>
            ))}
          </div>
        </footer>
      )
    }
  </article>

  <style>
    .post-header {
      padding: var(--space-3xl) 0 var(--space-2xl);
      text-align: center;
    }

    .post-meta {
      display: flex;
      gap: var(--space-md);
      justify-content: center;
      align-items: center;
      margin-bottom: var(--space-lg);
      font-size: 0.875rem;
      color: var(--color-text-muted);
    }

    .category {
      background: var(--color-accent);
      color: white;
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
      font-weight: 500;
    }

    .post-header h1 {
      max-width: var(--content-width);
      margin: 0 auto var(--space-lg);
      font-size: 2.5rem;
      line-height: 1.2;
    }

    .excerpt {
      max-width: var(--content-width);
      margin: 0 auto;
      font-size: 1.125rem;
      color: var(--color-text-muted);
      line-height: 1.6;
    }

    .cover-image {
      margin-bottom: var(--space-3xl);
      max-height: 500px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f5f5f5;
    }

    .cover-image img {
      width: 100%;
      height: auto;
      object-fit: cover;
    }

    .post-content {
      max-width: var(--content-width);
      margin: 0 auto;
      padding: 0 var(--space-lg);
    }

    .post-content :global(p) {
      margin-bottom: var(--space-lg);
    }

    .post-content :global(h2) {
      margin-top: var(--space-2xl);
      margin-bottom: var(--space-lg);
    }

    .post-content :global(h3) {
      margin-top: var(--space-xl);
      margin-bottom: var(--space-md);
    }

    .post-content :global(ul),
    .post-content :global(ol) {
      margin-bottom: var(--space-lg);
      padding-left: var(--space-xl);
    }

    .post-content :global(li) {
      margin-bottom: var(--space-sm);
    }

    .post-content :global(img) {
      margin: var(--space-xl) 0;
      border-radius: var(--radius-md);
    }

    .post-content :global(blockquote) {
      border-left: 4px solid var(--color-accent);
      padding-left: var(--space-lg);
      margin: var(--space-xl) 0;
      color: var(--color-text-muted);
      font-style: italic;
    }

    .post-footer {
      margin-top: var(--space-3xl);
      padding-top: var(--space-2xl);
      border-top: 1px solid var(--color-border);
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-sm);
    }

    .tag {
      background: #f5f5f5;
      padding: var(--space-xs) var(--space-md);
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      color: var(--color-text-muted);
      transition: all 0.2s ease;
    }

    .tag:hover {
      background: var(--color-accent);
      color: white;
    }

    @media (max-width: 768px) {
      .post-header h1 {
        font-size: 2rem;
      }

      .excerpt {
        font-size: 1rem;
      }
    }
  </style>
</BaseLayout>
